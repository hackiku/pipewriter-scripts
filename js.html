<!-- js.html -->

<script>
  const actionMap = {
    changeBg: (payload) => google.script.run.withSuccessHandler(() => console.log('Background changed')).withFailureHandler((error) => console.error('Failed to change background:', error)).changeBg(payload.color),
    deleteColumnWithCursor: () => google.script.run.withSuccessHandler(() => console.log('Column deleted')).deleteColumnWithCursor(),
    html2doc: () => google.script.run.withSuccessHandler(() => console.log('HTML to Doc conversion successful')).html2doc(),
    deleteHTMLtags: () => google.script.run.withSuccessHandler(() => console.log('HTML tags deleted')).deleteHTMLtags(),
    doc2html: () => google.script.run.withSuccessHandler(() => console.log('Doc to HTML conversion successful')).doc2html(),
    getElement: (payload) => google.script.run
      .withSuccessHandler(() => console.log('Element fetched', payload))
      .withFailureHandler((error) => console.error('Failed to fetch element:', error))
      .getElement(payload.elementId),
    aiReadDoc: () => google.script.run.withSuccessHandler(() => console.log('Doc read for AI')).aiReadDoc(),
  };

  window.addEventListener('message', function(event) {
    // Safety check
    if (!['http://localhost:5173', 'https://pipewriter.io', 'https://pipewriter.vercel.app'].includes(event.origin)) {
      console.error('Message from disallowed origin:', event.origin);
      return;
    }

    try {
      const { action, payload } = JSON.parse(event.data);

      // Check if the action exists in the map and call it
      if (action in actionMap) {
        actionMap[action](payload);
      } else {
        console.error("Action not recognized:", action);
      }
    } catch (error) {
      console.error("Error parsing message:", error);
    }
  });

</script>